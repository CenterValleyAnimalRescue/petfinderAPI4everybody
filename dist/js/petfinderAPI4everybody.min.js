/** petfinderAPI4everybody v0.1.0, by Chris Ferdinandi | http://github.com/cferdinandi/petfinderAPI4everybody | Licensed under MIT: http://gomakethings.com/mit/ */
!function(e,t){"function"==typeof define&&define.amd?define("petfinderAPI",t(e)):"object"==typeof exports?module.exports=t(e):e.petfinderAPI=t(e)}(window||this,function(e){"use strict";var t,o,n,a,i,s,r={},l=!!(document.querySelector&&e.addEventListener&&e.localStorage&&Array.prototype.indexOf),c={},p={},d={},u={},g={key:null,shelter:null,count:25,status:"A",offset:null,expiration:60,reverse:!1,initClass:"js-petfinder-api",allClass:"js-petfinder-api-all-pets",oneClass:"js-petfinder-api-one-pet",titlePrefix:"{{name}} | ",loading:"Fetching the latest pet info...",classPrefix:"pf-",toggleAll:"Select/Unselect All",noImage:"",breedDelimiter:", ",sizeUnknown:"Not Known",sizeS:"Small",sizeM:"Medium",sizeL:"Large",sizeXL:"Extra Large",ageUnknown:"Not Known",ageBaby:"Baby",ageYoung:"Young",ageAdult:"Adult",ageSenior:"Senior",genderUnknown:"Not Known",genderM:"Male",genderF:"Female",optionsSpecialNeeds:"Special Needs",optionsNoDogs:"No Dogs",optionsNoCats:"No Cats",optionsNoKids:"No Kids",optionsNoClaws:"No Claws",optionsHasShot:"Has hots",optionsHousebroken:"Housebroken",optionsAltered:"Spayed/Neutered",optionsNoDogsCatsKids:"No Dogs/Cats/Kids",optionsNoDogsCats:"No Dogs/Cats",optionsNoDogsKids:"No Dogs/Kids",optionsNoCatsKids:"No Cats/Kids",callbackBefore:function(){},callbackAfter:function(){}},m=function(e,t,o){if("[object Object]"===Object.prototype.toString.call(e))for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.call(o,e[n],n,e);else for(var a=0,i=e.length;i>a;a++)t.call(o,e[a],a,e)},f=function(e,t){var o={};return m(e,function(t,n){o[n]=e[n]}),m(t,function(e,n){o[n]=t[n]}),o},h=function(e){var o="http://api.petfinder.com/shelter.getPets?format=json",n="";return n+="&key="+t.key,n+="&id="+t.shelter,n+="&count="+parseInt(t.count,10),n+="&status="+t.status,n+="&output=full",t.offset&&(n+="&offset="+parseInt(t.offset,10)),e&&(n+="&callback="+e),o+n},b=function(e){var t=window.document.getElementsByTagName("script")[0],o=window.document.createElement("script");o.src=e,t.parentNode.insertBefore(o,t),o.onload=function(){this.remove()}};r.setAPIData=function(e){if("100"!==e.petfinder.header.status.code.$t)return console.log("Unable to get data from Petfinder. Using expired localStorage data instead."),void 0;var o=60*parseInt(t.expiration,10)*1e3;n={pets:e.petfinder.pets.pet,timestamp:(new Date).getTime()+o},localStorage.setItem(a,JSON.stringify(n)),U()};var v=function(){if(n=JSON.parse(localStorage.getItem(a)),n&&(new Date).getTime()<n.timestamp)return U(),void 0;var e=h("petfinderAPI.setAPIData");b(e)},S=function(e){var o=e?t.titlePrefix+u.title:u.title;o=o.replace(/\{\{name\}\}/,e),document.title=o},x=function(e,o,n){var a=n,i=function(t,o){e.options.option&&m(e.options.option,function(e){e.$t===t&&(a=o)})};if("description"===o&&(a=L(e.description.$t),a=y(a),a=N(a),a='<div style="white-space: pre-wrap;">'+a+"</div>"),"breeds"===o){if("[object Object]"===Object.prototype.toString.call(e.breeds.breed))return a=e.breeds.breed.$t;m(e.breeds.breed,function(e,o){a+=0===o?"":t.breedDelimiter,a+=e.$t})}if("size"===o&&("S"===e.size.$t&&(a=t.sizeS),"M"===e.size.$t&&(a=t.sizeM),"L"===e.size.$t&&(a=t.sizeL),"XL"===e.size.$t&&(a=t.sizeXL)),"age"===o&&("Baby"===e.age.$t&&(a=t.ageBaby),"Young"===e.age.$t&&(a=t.ageYoung),"Adult"===e.age.$t&&(a=t.ageAdult),"Senior"===e.age.$t&&(a=t.ageSenior)),"gender"===o&&("M"===e.sex.$t&&(a=t.genderM),"F"===e.sex.$t&&(a=t.genderF)),"multiOptions"===o){var s,r,l;if(!e.options.option)return;m(e.options.option,function(e){"noCats"===e.$t&&(s=!0),"noDogs"===e.$t&&(r=!0),"noKids"===e.$t&&(l=!0)}),s===!0&&r===!0&&l===!0&&(a=t.optionsNoDogsCatsKids),s===!0&&r===!0&&(a=t.optionsNoDogsCats),r===!0&&l===!0&&(a=t.optionsNoDogsKids),s===!0&&l===!0&&(a=t.optionsNoCatsKids),r===!0&&(a=t.optionsNoDogs),s===!0&&(a=t.optionsNoCats),l===!0&&(a=t.optionsNoKids)}return"specialNeeds"===o&&i("specialNeeds",t.optionsSpecialNeeds),"noDogs"===o&&i("noDogs",t.optionsNoDogs),"noCats"===o&&i("noCats",t.optionsNoCats),"noKids"===o&&i("noKids",t.optionsNoKids),"noClaws"===o&&i("noClaws",t.optionsNoClaws),"hasShot"===o&&i("hasShots",t.optionsHasShots),"housebroken"===o&&i("housebroken",t.optionsHousebroken),"altered"===o&&i("altered",t.optionsAltered),a},k=function(e,o,n){if(0===e.media.photos.photo.count)return"";var a,i=t.noImage;return"large"===o&&(a="x"),"medium"===o&&(a="pn"),"thumbSmall"===o&&(a="t"),"thumbMedium"===o&&(a="pnt"),"thumbLarge"===o&&(a="fpm"),m(e.media.photos.photo,function(e){return e["@size"]===a&&e["@id"]===n?(i=e.$t,void 0):void 0}),i},y=function(e){return e&&""!==e?e.replace(/(http|https|ftp|ftps)\:\/\/[a-zA-Z0-9\-\.]+\.[a-zA-Z]{2,3}(\/\S*)?/g,'<a href="$&" rel="nofollow">$&</a>'):void 0},N=function(e){return e&&""!==e?e.replace(/([a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4})/g,'<a href="mailto:$&">$&</a>'):void 0},L=function(e){return e&&""!==e?e.replace(/<p><\/p>/g,"").replace(/<p> <\/p>/g,"").replace(/<p>&nbsp;<\/p>/g,"").replace(/&nbsp;/g,"").replace(/<span>/g,"").replace(/<\/span>/g,"").replace(/<font>/g,"").replace(/<\/font>/g,""):void 0},C=function(e,o){return e&&""!==e?(o&&(e=t.classPrefix+e),e.replace(/\(/g,"").replace(/\)/g,"").replace(/\&/g,"-").replace(/\//g,"-").replace(/ /g,"-").toLowerCase()):void 0},w=function(e){if("[object Object]"===Object.prototype.toString.call(e.breeds.breed))return" "+C(e.breeds.breed.$t,!0);var t="";return m(e.breeds.breed,function(e){t+=" "+C(e.$t,!0)}),t},$=function(e){return[t.classPrefix+"pet",C(x(e,"age",t.ageUnknown),!0),C(e.animal.$t,!0),w(e),C(x(e,"specialNeeds",""),!0),C(x(e,"noDogs",""),!0),C(x(e,"noCats",""),!0),C(x(e,"noKids",""),!0),C(x(e,"noClaws",""),!0),C(x(e,"hasShots",""),!0),C(x(e,"housebroken",""),!0),C(x(e,"altered",""),!0),C(x(e,"gender",t.genderUnknown),!0),C(x(e,"size",t.sizeUnknown),!0)].join(" ")},z=function(e,t){if(d[e])return d[e];var o=[],a=[];return m(n.pets,function(n){return t&&0!==Object.getOwnPropertyNames(n[e]).length?(m(n[e][t],function(e){return"[object Object]"===Object.prototype.toString.call(e)?(m(e,function(e){-1===o.indexOf(e)&&o.push(e)}),void 0):(-1===o.indexOf(e)&&o.push(e),void 0)}),void 0):(-1===o.indexOf(n[e].$t)&&o.push(n[e].$t),void 0)}),o.sort(),"size"===e&&(-1!==o.indexOf("S")&&a.push("S"),-1!==o.indexOf("M")&&a.push("M"),-1!==o.indexOf("L")&&a.push("L"),-1!==o.indexOf("XL")&&a.push("XL"),o=a),"age"===e&&(-1!==o.indexOf("Baby")&&a.push("Baby"),-1!==o.indexOf("Young")&&a.push("Young"),-1!==o.indexOf("Adult")&&a.push("Adult"),-1!==o.indexOf("Senior")&&a.push("Senior"),o=a),d[e]=o,o},D=function(e,t){var o="",n=z(e,t);return m(n,function(e){o+="<li>"+e+"</li>"}),o},A=function(e,o){var n="",a="",i="breeds"===e?"pf-breeds":"pf-sort",s=null;"breeds"===e&&(s="breed"),"options"===e&&(s="option");var r=z(e,s);return m(r,function(t){var o=C(t,!0);n+='<label><input type="checkbox" class="'+i+" pf-sort-"+e+'" data-target=".'+o+'" checked>'+t+"</label>"}),o&&(a='<label><input type="checkbox" class="pf-toggle-all" data-target=".pf-sort-'+e+'" checked>'+t.toggleAll+"</label>"),a+n},O=function(){var e=document.querySelector('[data-petfinder-template="all"]'),t=document.querySelector('[data-petfinder-template="one"]'),o=document.querySelector('[data-petfinder-template="aside-all"]'),n=document.querySelector('[data-petfinder-template="aside-one"]');e&&(c.allPets=e.innerHTML),t&&(c.onePet=t.innerHTML),o&&(c.asideAllPets=o.innerHTML),n&&(c.asideOnePet=n.innerHTML)},M=function(e,o,n){return e?o.replace(/\{\{age\}\}/,x(e,"age",t.ageUnknown)).replace(/\{\{animal\}\}/,e.animal.$t).replace(/\{\{breeds\}\}/,x(e,"breeds","")).replace(/\{\{description\}\}/,x(e,"description","")).replace(/\{\{id\}\}/g,e.id.$t).replace(/\{\{photo.1.large\}\}/g,k(e,"large","1")).replace(/\{\{photo.2.large\}\}/g,k(e,"large","2")).replace(/\{\{photo.3.large\}\}/g,k(e,"large","3")).replace(/\{\{photo.1.medium\}\}/g,k(e,"medium","1")).replace(/\{\{photo.2.medium\}\}/g,k(e,"medium","2")).replace(/\{\{photo.3.medium\}\}/g,k(e,"medium","3")).replace(/\{\{photo.1.thumbSmall\}\}/g,k(e,"thumbSmall","1")).replace(/\{\{photo.2.thumbSmall\}\}/g,k(e,"thumbSmall","2")).replace(/\{\{photo.3.thumbSmall\}\}/g,k(e,"thumbSmall","3")).replace(/\{\{photo.1.thumbMedium\}\}/g,k(e,"thumbMedium","1")).replace(/\{\{photo.2.thumbMedium\}\}/g,k(e,"thumbMedium","2")).replace(/\{\{photo.3.thumbMedium\}\}/g,k(e,"thumbMedium","3")).replace(/\{\{photo.1.thumbLarge\}\}/g,k(e,"thumbLarge","1")).replace(/\{\{photo.2.thumbLarge\}\}/g,k(e,"thumbLarge","2")).replace(/\{\{photo.3.thumbLarge\}\}/g,k(e,"thumbLarge","3")).replace(/\{\{name\}\}/g,e.name.$t).replace(/\{\{options.multi\}\}/,x(e,"multiOptions","")).replace(/\{\{options.specialNeeds\}\}/,x(e,"specialNeeds","")).replace(/\{\{options.noDogs\}\}/,x(e,"noDogs","")).replace(/\{\{options.noCats\}\}/,x(e,"noCats","")).replace(/\{\{options.noKids\}\}/,x(e,"noKids","")).replace(/\{\{options.noClaws\}\}/,x(e,"noClaws","")).replace(/\{\{options.hasShots\}\}/,x(e,"hasShots","")).replace(/\{\{options.housebroken\}\}/,x(e,"housebroken","")).replace(/\{\{options.altered\}\}/,x(e,"altered","")).replace(/\{\{gender\}\}/,x(e,"gender",t.genderUnknown)).replace(/\{\{size\}\}/,x(e,"size",t.sizeUnknown)).replace(/\{\{url.all\}\}/g,i).replace(/\{\{url.pet\}\}/g,i+"?petID="+e.id.$t).replace(/\{\{url.petfinder\}\}/g,"https://www.petfinder.com/petdetail/"+e.id.$t).replace(/\{\{classes\}\}/,$(e)).replace(/\{\{number\}\}/g,n).replace(/\{\{count\}\}/g,s):o.replace(/\{\{list.ages\}\}/,D("age")).replace(/\{\{list.animals\}\}/,D("animal")).replace(/\{\{list.breeds\}\}/,D("breeds","breed")).replace(/\{\{list.options\}\}/,D("options","option")).replace(/\{\{list.genders\}\}/,D("sex")).replace(/\{\{list.sizes\}\}/,D("size")).replace(/\{\{checkbox.ages\}\}/,A("age")).replace(/\{\{checkbox.animals\}\}/,A("animal")).replace(/\{\{checkbox.breeds\}\}/,A("breeds")).replace(/\{\{checkbox.options\}\}/,A("options")).replace(/\{\{checkbox.genders\}\}/,A("sex")).replace(/\{\{checkbox.sizes\}\}/,A("size")).replace(/\{\{checkbox.ages.toggle\}\}/,A("age",!0)).replace(/\{\{checkbox.animals.toggle\}\}/,A("animal",!0)).replace(/\{\{checkbox.breeds.toggle\}\}/,A("breeds",!0)).replace(/\{\{checkbox.options.toggle\}\}/,A("options",!0)).replace(/\{\{checkbox.genders.toggle\}\}/,A("sex",!0)).replace(/\{\{checkbox.sizes.toggle\}\}/,A("size",!0)).replace(/\{\{count\}\}/g,s)},P=function(e){history.pushState&&history.pushState(null,null,e)},j=function(e){var t={};return m(n.pets,function(o,n){o.id.$t===e&&(t.pet=o,t.number=n)}),t},K=function(e){if(p.aside){var t=e?M(null,e):"";p.aside.innerHTML=t}},I=function(){var e="";m(n.pets,function(t,o){e+=M(t,c.allPets,o)}),p.main.innerHTML=e,S(),document.documentElement.classList.add(t.allClass),document.documentElement.classList.remove(t.oneClass)},H=function(e){var o=j(e);if(o.pet&&c.onePet){var n=M(o.pet,c.onePet,o.number);p.main.innerHTML=n,S(o.pet.name.$t),document.documentElement.classList.add(t.oneClass),document.documentElement.classList.remove(t.allClass)}},T=function(){t.loading&&(p.main.innerHTML=t.loading)},E=function(o,n){return t.callbackBefore(),e.scrollTo(0,0),o?(H(o[1]),K(c.asideOnePet),n&&P(i+"?petID="+o[1]),void 0):(I(),K(c.asideAllPets),n&&P(i),t.callbackAfter(),void 0)},U=function(){if(!n)return p.main.innerHTML=u.content,console.log("Unable to retrieve Petfinder data from the API or localStorage."),void 0;t.reverse&&n.reverse(),s=n.pets.length;var o=/[\\?&]petID=([^&#]*)/i.exec(e.location.href);E(o,!0)},B=function(e){if(history.pushState){{var t=e.target;new RegExp(i)}if(t.hasAttribute("data-petfinder-async")){e.preventDefault();var o=/[\\?&]petID=([^&#]*)/i.exec(t);E(o,!0)}}},q=function(){if(history.pushState){var t=/[\\?&]petID=([^&#]*)/i.exec(e.location.href);E(t)}};return r.destroy=function(){t&&(document.documentElement.classList.remove(t.initClass),document.documentElement.classList.remove(t.allClass),document.documentElement.classList.remove(t.oneClass),p.main&&u.content&&(p.main.innerHTML=u.content),p.aside&&(p.aside.innerHTML=""),u.title&&(document.title=u.title),document.removeEventListener("click",B,!1),c={},p={},d={},u={},t=null,o=null,n=null,a=null,i=null,s=null)},r.init=function(o){if(l){if(r.destroy(),t=f(g,o||{}),!t.key||!t.shelter)return console.log("You must provide a Petfinder API key and shelter ID to use petfinderAPI4everybody.js"),void 0;document.documentElement.classList.add(t.initClass),a=[t.key,t.shelter,t.count,t.status,t.offset].join(""),p.main=document.querySelector('[data-petfinder-app="main"]'),p.aside=document.querySelector('[data-petfinder-app="aside"]'),u.content=p.main.innerHTML,u.title=document.title,i=[location.protocol,"//",location.host,location.pathname].join(""),O(),T(),v(),document.addEventListener("click",B,!1),e.onpopstate=q}},r});